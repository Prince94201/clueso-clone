const n={recording:!1},o="offscreen/offscreen.html";async function a(){await chrome.offscreen.hasDocument?.()||await chrome.offscreen.createDocument({url:o,reasons:["USER_MEDIA"],justification:"Record the current tab using MediaRecorder in an offscreen document."})}async function c(t){t?await chrome.storage.local.set({authToken:t}):await chrome.storage.local.remove("authToken")}async function i(){return(await chrome.storage.local.get("authToken"))?.authToken??null}chrome.runtime.onMessage.addListener((t,u,e)=>((async()=>{if(t?.type==="AUTH_SYNC"){const r=typeof t?.token=="string"?t.token:null;r&&await c(r),e({ok:!0});return}if(t?.type==="AUTH_STATUS"){const r=await i();e({ok:!0,signedIn:!!r});return}if(t?.type==="GET_STATE"){e({recording:n.recording});return}if(t?.type==="START_RECORDING"){if(n.recording){e({ok:!0,recording:!0});return}await a();const r=await chrome.tabCapture.getMediaStreamId({targetTabId:t?.tabId});await chrome.runtime.sendMessage({type:"OFFSCREEN_START",streamId:r,withMic:!!t?.withMic}),n.recording=!0,e({ok:!0,recording:!0});return}if(t?.type==="STOP_RECORDING"){if(!n.recording){e({ok:!0,recording:!1});return}const r=await chrome.runtime.sendMessage({type:"OFFSCREEN_STOP"});n.recording=!1,e({ok:!0,recording:!1,result:r});return}e({ok:!1,error:"Unknown message"})})().catch(r=>{e({ok:!1,error:String(r?.message??r)})}),!0));
//# sourceMappingURL=background.js.map
