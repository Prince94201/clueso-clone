{"version":3,"file":"popup.js","sources":["../../src/popup/popup.ts"],"sourcesContent":["const APP_ORIGIN = 'http://localhost:3000';\n\nasync function getActiveTabId(): Promise<number> {\n  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });\n  if (!tab?.id) throw new Error('No active tab');\n  return tab.id;\n}\n\nasync function getActiveTab(): Promise<chrome.tabs.Tab | undefined> {\n  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });\n  return tab;\n}\n\nfunction qs(id: string) {\n  return document.getElementById(id) as HTMLElement | null;\n}\n\nfunction setStatus(text: string) {\n  const el = qs('status');\n  if (el) el.textContent = text;\n}\n\nfunction setAuth(text: string) {\n  const el = qs('auth');\n  if (el) el.textContent = text;\n}\n\nfunction setAuthHintVisible(visible: boolean) {\n  const el = qs('authHint');\n  if (el) (el as HTMLElement).style.display = visible ? 'block' : 'none';\n}\n\nfunction showRecordSection(show: boolean) {\n  const record = qs('recordSection');\n  if (record) record.classList.toggle('hidden', !show);\n  const chooseRecord = qs('chooseRecord');\n  const chooseUpload = qs('chooseUpload');\n  if (chooseRecord) chooseRecord.classList.toggle('hidden', show);\n  if (chooseUpload) chooseUpload.classList.toggle('hidden', show);\n}\n\nasync function refreshAuth() {\n  const res = await chrome.runtime.sendMessage({ type: 'AUTH_STATUS' });\n  const signedIn = Boolean(res?.signedIn);\n  setAuth(signedIn ? 'Connected' : 'Not connected');\n  setAuthHintVisible(!signedIn);\n}\n\nasync function requestTokenFromPageIfPossible() {\n  const tab = await getActiveTab();\n  const url = tab?.url ?? '';\n  if (!url.startsWith(APP_ORIGIN)) return;\n  if (!tab?.id) return;\n\n  await chrome.scripting.executeScript({\n    target: { tabId: tab.id },\n    func: () => {\n      window.postMessage({ type: 'CLUESO_CLONE_REQUEST_TOKEN' }, '*');\n    }\n  });\n}\n\nasync function refreshState() {\n  const state = await chrome.runtime.sendMessage({ type: 'GET_STATE' });\n  const recording = Boolean(state?.recording);\n\n  (qs('start') as HTMLButtonElement).disabled = recording;\n  (qs('stop') as HTMLButtonElement).disabled = !recording;\n  setStatus(recording ? 'Recording…' : 'Idle');\n\n  // If recording is active, always show the record controls so Stop is available\n  if (recording) showRecordSection(true);\n}\n\nasync function start() {\n  const tabId = await getActiveTabId();\n  const withMic = (qs('mic') as HTMLInputElement).checked;\n\n  setStatus('Starting…');\n  const res = await chrome.runtime.sendMessage({ type: 'START_RECORDING', tabId, withMic });\n  if (!res?.ok) throw new Error(res?.error ?? 'Failed to start');\n\n  // Ensure the record section stays visible after starting so Stop is shown\n  showRecordSection(true);\n  await refreshState();\n}\n\nasync function stop() {\n  setStatus('Stopping…');\n  const res = await chrome.runtime.sendMessage({ type: 'STOP_RECORDING' });\n  if (!res?.ok) throw new Error(res?.error ?? 'Failed to stop');\n\n  const result = res?.result?.result;\n  if (result?.url && result?.filename) {\n    await chrome.downloads.download({\n      url: result.url,\n      filename: result.filename,\n      saveAs: true\n    });\n  }\n\n  await refreshState();\n}\n\nasync function openApp(path: string) {\n  await chrome.tabs.create({ url: `${APP_ORIGIN}${path}` });\n}\n\nqs('chooseRecord')?.addEventListener('click', () => {\n  // Most suitable: use the web app recorder UI (more features, uploads to library)\n  openApp('/dashboard?record=1').catch(() => void 0);\n});\n\nqs('chooseUpload')?.addEventListener('click', () => {\n  openApp('/videos/upload').catch(() => void 0);\n});\n\nqs('back')?.addEventListener('click', () => {\n  showRecordSection(false);\n});\n\nqs('start')?.addEventListener('click', () => {\n  start().catch((e) => setStatus(String(e?.message ?? e)));\n});\n\nqs('stop')?.addEventListener('click', () => {\n  stop().catch((e) => setStatus(String(e?.message ?? e)));\n});\n\n(async () => {\n  // If the user is already recording and reopens the popup, show Stop immediately.\n  showRecordSection(false);\n  await refreshAuth();\n  await requestTokenFromPageIfPossible();\n  await refreshAuth();\n  await refreshState();\n})().catch(() => void 0);\n"],"names":["APP_ORIGIN","getActiveTabId","tab","getActiveTab","qs","id","setStatus","text","el","setAuth","setAuthHintVisible","visible","showRecordSection","show","record","chooseRecord","chooseUpload","refreshAuth","signedIn","requestTokenFromPageIfPossible","refreshState","recording","start","tabId","withMic","res","stop","result","openApp","path","e"],"mappings":"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"}