{"version":3,"file":"popup.js","sources":["../../src/popup/popup.ts"],"sourcesContent":["const APP_ORIGIN = 'http://localhost:3000';\n\nasync function getActiveTabId(): Promise<number> {\n  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });\n  if (!tab?.id) throw new Error('No active tab');\n  return tab.id;\n}\n\nasync function getActiveTab(): Promise<chrome.tabs.Tab | undefined> {\n  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });\n  return tab;\n}\n\nfunction qs(id: string) {\n  return document.getElementById(id) as HTMLElement | null;\n}\n\nfunction setStatus(text: string) {\n  const el = qs('status');\n  if (el) el.textContent = text;\n}\n\nfunction setAuth(text: string) {\n  const el = qs('auth');\n  if (el) el.textContent = text;\n}\n\nfunction setAuthHintVisible(visible: boolean) {\n  const el = qs('authHint');\n  if (el) (el as HTMLElement).style.display = visible ? 'block' : 'none';\n}\n\nasync function refreshState() {\n  const state = await chrome.runtime.sendMessage({ type: 'GET_STATE' });\n  const recording = Boolean(state?.recording);\n\n  (qs('start') as HTMLButtonElement).disabled = recording;\n  (qs('stop') as HTMLButtonElement).disabled = !recording;\n  setStatus(recording ? 'Recording…' : 'Idle');\n}\n\nasync function start() {\n  const tabId = await getActiveTabId();\n  const withMic = (qs('mic') as HTMLInputElement).checked;\n\n  setStatus('Starting…');\n  const res = await chrome.runtime.sendMessage({ type: 'START_RECORDING', tabId, withMic });\n  if (!res?.ok) throw new Error(res?.error ?? 'Failed to start');\n\n  await refreshState();\n}\n\nasync function stop() {\n  setStatus('Stopping…');\n  const res = await chrome.runtime.sendMessage({ type: 'STOP_RECORDING' });\n  if (!res?.ok) throw new Error(res?.error ?? 'Failed to stop');\n\n  const result = res?.result?.result;\n  if (result?.url && result?.filename) {\n    await chrome.downloads.download({\n      url: result.url,\n      filename: result.filename,\n      saveAs: true\n    });\n  }\n\n  await refreshState();\n}\n\nasync function openApp(path: string) {\n  await chrome.tabs.create({ url: `${APP_ORIGIN}${path}` });\n}\n\nqs('start')?.addEventListener('click', () => {\n  start().catch((e) => setStatus(String(e?.message ?? e)));\n});\n\nqs('stop')?.addEventListener('click', () => {\n  stop().catch((e) => setStatus(String(e?.message ?? e)));\n});\n\n(async () => {\n  await refreshState();\n})();\n"],"names":["getActiveTabId","tab","qs","id","setStatus","text","el","refreshState","recording","start","tabId","withMic","res","stop","result","e"],"mappings":"6CAEA,eAAeA,GAAkC,CAC/C,KAAM,CAACC,CAAG,EAAI,MAAM,OAAO,KAAK,MAAM,CAAE,OAAQ,GAAM,cAAe,EAAA,CAAM,EAC3E,GAAI,CAACA,GAAK,GAAI,MAAM,IAAI,MAAM,eAAe,EAC7C,OAAOA,EAAI,EACb,CAOA,SAASC,EAAGC,EAAY,CACtB,OAAO,SAAS,eAAeA,CAAE,CACnC,CAEA,SAASC,EAAUC,EAAc,CAC/B,MAAMC,EAAKJ,EAAG,QAAQ,EAClBI,MAAO,YAAcD,EAC3B,CAYA,eAAeE,GAAe,CAE5B,MAAMC,EAAY,GADJ,MAAM,OAAO,QAAQ,YAAY,CAAE,KAAM,YAAa,IACnC,UAEhCN,EAAG,OAAO,EAAwB,SAAWM,EAC7CN,EAAG,MAAM,EAAwB,SAAW,CAACM,EAC9CJ,EAAUI,EAAY,aAAe,MAAM,CAC7C,CAEA,eAAeC,GAAQ,CACrB,MAAMC,EAAQ,MAAMV,EAAA,EACdW,EAAWT,EAAG,KAAK,EAAuB,QAEhDE,EAAU,WAAW,EACrB,MAAMQ,EAAM,MAAM,OAAO,QAAQ,YAAY,CAAE,KAAM,kBAAmB,MAAAF,EAAO,QAAAC,EAAS,EACxF,GAAI,CAACC,GAAK,GAAI,MAAM,IAAI,MAAMA,GAAK,OAAS,iBAAiB,EAE7D,MAAML,EAAA,CACR,CAEA,eAAeM,GAAO,CACpBT,EAAU,WAAW,EACrB,MAAMQ,EAAM,MAAM,OAAO,QAAQ,YAAY,CAAE,KAAM,iBAAkB,EACvE,GAAI,CAACA,GAAK,GAAI,MAAM,IAAI,MAAMA,GAAK,OAAS,gBAAgB,EAE5D,MAAME,EAASF,GAAK,QAAQ,OACxBE,GAAQ,KAAOA,GAAQ,UACzB,MAAM,OAAO,UAAU,SAAS,CAC9B,IAAKA,EAAO,IACZ,SAAUA,EAAO,SACjB,OAAQ,EAAA,CACT,EAGH,MAAMP,EAAA,CACR,CAMAL,EAAG,OAAO,GAAG,iBAAiB,QAAS,IAAM,CAC3CO,EAAA,EAAQ,MAAOM,GAAMX,EAAU,OAAOW,GAAG,SAAWA,CAAC,CAAC,CAAC,CACzD,CAAC,EAEDb,EAAG,MAAM,GAAG,iBAAiB,QAAS,IAAM,CAC1CW,EAAA,EAAO,MAAOE,GAAMX,EAAU,OAAOW,GAAG,SAAWA,CAAC,CAAC,CAAC,CACxD,CAAC,GAEA,SACC,MAAMR,EAAA"}