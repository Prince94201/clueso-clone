{"version":3,"file":"content-script.js","sources":["../src/content-script.ts"],"sourcesContent":["function getToken(): string | null {\n  try {\n    return window.localStorage.getItem('token');\n  } catch {\n    return null;\n  }\n}\n\nasync function syncTokenToExtension() {\n  const token = getToken();\n  if (!token) return;\n  try {\n    await chrome.runtime.sendMessage({ type: 'AUTH_SYNC', token });\n    window.postMessage({ type: 'CLUESO_CLONE_TOKEN_SYNCED' }, '*');\n  } catch {\n    // ignore if extension not available\n  }\n}\n\n// Initial attempt on page load\nvoid syncTokenToExtension();\n\n// Re-attempt shortly after load (helps when localStorage token is set after navigation)\nsetTimeout(() => void syncTokenToExtension(), 500);\nsetTimeout(() => void syncTokenToExtension(), 2000);\n\n// Listen for explicit requests from the page\nwindow.addEventListener('message', (event) => {\n  if (event.source !== window) return;\n  if (event.data?.type !== 'CLUESO_CLONE_REQUEST_TOKEN') return;\n  void syncTokenToExtension();\n});\n\n// Listen for token changes in other tabs\n// Listen for token changes in other tabs\nwindow.addEventListener('storage', (e) => {\n  if (e.key === 'token') void syncTokenToExtension();\n});\n\nlet uiContainer: HTMLElement | null = null;\nlet timerInterval: number | null = null;\nlet startTime: number = 0;\n\nfunction createUI() {\n  if (uiContainer) return;\n\n  const host = document.createElement('div');\n  host.id = 'clueso-recorder-host';\n  host.style.position = 'fixed';\n  host.style.bottom = '20px';\n  host.style.left = '20px';\n  host.style.zIndex = '2147483647';\n\n  const shadow = host.attachShadow({ mode: 'open' });\n\n  const style = document.createElement('style');\n  style.textContent = `\n    .container {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      padding: 8px 16px;\n      background: white;\n      border-radius: 999px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n      font-size: 14px;\n      color: #111;\n    }\n    .red-dot {\n      width: 8px;\n      height: 8px;\n      background-color: #ef4444;\n      border-radius: 50%;\n    }\n    .recording-text {\n      font-weight: 500;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n    }\n    .timer {\n      color: #666;\n      min-width: 24px;\n      font-feature-settings: \"tnum\";\n      font-variant-numeric: tabular-nums;\n    }\n    .separator {\n      width: 1px;\n      height: 24px;\n      background-color: #e5e7eb;\n    }\n    button {\n      cursor: pointer;\n      border: none;\n      font-size: 14px;\n      font-weight: 500;\n      transition: opacity 0.2s;\n    }\n    button:hover {\n      opacity: 0.9;\n    }\n    .btn-stop {\n      background-color: #ef4444;\n      color: white;\n      padding: 6px 16px;\n      border-radius: 6px;\n    }\n    .btn-discard {\n      background-color: white;\n      color: #111;\n      border: 1px solid #e5e7eb;\n      padding: 6px 12px;\n      border-radius: 6px;\n    }\n    .btn-open {\n      background: none;\n      color: #111;\n      padding: 6px 8px;\n    }\n  `;\n\n  const wrapper = document.createElement('div');\n  wrapper.className = 'container';\n  wrapper.innerHTML = `\n    <div class=\"recording-text\">\n      <div class=\"red-dot\"></div>\n      <span>Recording</span>\n    </div>\n    <div class=\"timer\" id=\"timer\">0s</div>\n    <div class=\"separator\"></div>\n    <button class=\"btn-stop\" id=\"stopBtn\">Stop</button>\n    <button class=\"btn-discard\" id=\"discardBtn\">Discard</button>\n    <button class=\"btn-open\" id=\"openBtn\">Open</button>\n  `;\n\n  shadow.appendChild(style);\n  shadow.appendChild(wrapper);\n  document.body.appendChild(host);\n  uiContainer = host;\n\n  shadow.getElementById('stopBtn')?.addEventListener('click', () => {\n    chrome.runtime.sendMessage({ type: 'STOP_RECORDING' });\n  });\n\n  shadow.getElementById('discardBtn')?.addEventListener('click', () => {\n    chrome.runtime.sendMessage({ type: 'STOP_RECORDING', discard: true });\n  });\n\n  shadow.getElementById('openBtn')?.addEventListener('click', () => {\n    window.open('http://localhost:3000/dashboard', '_blank');\n  });\n}\n\nfunction removeUI() {\n  if (uiContainer) {\n    uiContainer.remove();\n    uiContainer = null;\n  }\n}\n\nfunction startTimer() {\n  startTime = Date.now();\n  const update = () => {\n    if (!uiContainer?.shadowRoot) return;\n    const el = uiContainer.shadowRoot.getElementById('timer');\n    if (el) {\n      const diff = Math.floor((Date.now() - startTime) / 1000);\n      el.textContent = `${diff}s`;\n    }\n  };\n  if (timerInterval) clearInterval(timerInterval);\n  timerInterval = window.setInterval(update, 1000);\n  update();\n}\n\nfunction stopTimer() {\n  if (timerInterval) {\n    clearInterval(timerInterval);\n    timerInterval = null;\n  }\n}\n\nchrome.runtime.onMessage.addListener((message) => {\n  if (message.type === 'SHOW_CLUESO_UI') {\n    createUI();\n    startTimer();\n  }\n  if (message.type === 'HIDE_CLUESO_UI') {\n    stopTimer();\n    removeUI();\n  }\n  if (message.type === 'UPDATE_UI') {\n    if (message.status === 'uploading') {\n      stopTimer();\n      if (uiContainer?.shadowRoot) {\n        const container = uiContainer.shadowRoot.querySelector('.container');\n        if (container) {\n          container.innerHTML = `\n            <div class=\"recording-text\" style=\"color:#666\">\n              <div class=\"red-dot\" style=\"background-color:#fbbf24\"></div>\n              <span>Uploading to library...</span>\n            </div>\n          `;\n        }\n      }\n    }\n  }\n\n  if (message.type === 'SHOW_ERROR') {\n    stopTimer();\n    if (uiContainer?.shadowRoot) {\n      const container = uiContainer.shadowRoot.querySelector('.container');\n      if (container) {\n        container.innerHTML = `\n            <div class=\"recording-text\" style=\"color:#ef4444\">\n              <div class=\"red-dot\"></div>\n              <span>${message.error || 'Error'}</span>\n            </div>\n          `;\n      }\n    }\n  }\n});\n"],"names":["getToken","syncTokenToExtension","token","event","e","uiContainer","timerInterval","startTime","createUI","host","shadow","style","wrapper","removeUI","startTimer","update","el","diff","stopTimer","message","container"],"mappings":"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"}